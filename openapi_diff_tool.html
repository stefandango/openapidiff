<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAPI Diff Tool</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .upload-section {
            padding: 40px;
            border-bottom: 1px solid #eee;
        }

        .upload-area {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
        }

        .file-upload {
            flex: 1;
            min-width: 250px;
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }

        .file-upload:hover {
            border-color: #764ba2;
            background: #f0f4ff;
            transform: translateY(-2px);
        }

        .file-upload.dragover {
            border-color: #4CAF50;
            background: #f0fff0;
        }

        .file-upload input {
            display: none;
        }

        .file-upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 15px;
        }

        .file-upload h3 {
            color: #333;
            margin-bottom: 10px;
            font-weight: 500;
        }

        .file-info {
            margin-top: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
            color: #555;
        }

        .compare-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: block;
            margin: 0 auto;
            font-weight: 500;
        }

        .compare-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .compare-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-section {
            padding: 40px;
            display: none;
        }

        .results-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-title {
            font-size: 1.8rem;
            color: #333;
            font-weight: 500;
        }

        .filter-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #667eea;
            background: transparent;
            color: #667eea;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .filter-btn:hover {
            background: #667eea;
            color: white;
        }

        .timeline {
            position: relative;
            padding-left: 30px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #667eea, #764ba2);
        }

        .change-item {
            position: relative;
            margin-bottom: 30px;
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
            border-left: 5px solid #667eea;
            transition: all 0.3s ease;
        }

        .change-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        .change-item::before {
            content: '';
            position: absolute;
            left: -37px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
            border: 3px solid white;
            box-shadow: 0 0 0 3px #667eea;
        }

        .change-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .change-type {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .change-path {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .change-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        .badge-added { background: #e8f5e8; color: #2e7d2e; }
        .badge-removed { background: #ffeaea; color: #d63384; }
        .badge-modified { background: #fff3cd; color: #856404; }
        .badge-breaking { background: #f8d7da; color: #721c24; }

        .change-details {
            margin-top: 15px;
        }

        .detail-section {
            margin-bottom: 15px;
        }

        .detail-title {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .detail-content {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            border-left: 3px solid #667eea;
        }

        .diff-line {
            margin: 2px 0;
        }

        .diff-added { color: #28a745; }
        .diff-removed { color: #dc3545; }

        .stats-summary {
            background: linear-gradient(135deg, #f8f9ff 0%, #fff3f8 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            display: block;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .no-changes {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .no-changes-icon {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #667eea;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 15px;
            }
            
            .header {
                padding: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .upload-section, .results-section {
                padding: 20px;
            }
            
            .file-upload {
                min-width: 100%;
                padding: 20px;
            }
            
            .change-item {
                padding: 20px;
                margin-left: -10px;
            }
            
            .timeline {
                padding-left: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîÑ OpenAPI Diff Tool</h1>
            <p>Compare OpenAPI/Swagger specifications and track changes chronologically</p>
        </div>

        <div class="upload-section">
            <div class="upload-area">
                <div class="file-upload" id="upload1">
                    <input type="file" id="file1" accept=".json,.yaml,.yml">
                    <div class="file-upload-icon">üìÑ</div>
                    <h3>Upload First API Spec</h3>
                    <p>Drop your OpenAPI/Swagger file here or click to browse</p>
                    <div class="file-info" id="info1" style="display: none;"></div>
                </div>

                <div class="file-upload" id="upload2">
                    <input type="file" id="file2" accept=".json,.yaml,.yml">
                    <div class="file-upload-icon">üìÑ</div>
                    <h3>Upload Second API Spec</h3>
                    <p>Drop your OpenAPI/Swagger file here or click to browse</p>
                    <div class="file-info" id="info2" style="display: none;"></div>
                </div>
            </div>

            <button class="compare-btn" id="compareBtn" disabled>
                üîç Compare API Specifications
            </button>
        </div>

        <div class="results-section" id="resultsSection">
            <div class="results-header">
                <h2 class="results-title">üìä Comparison Results</h2>
                <div class="filter-controls">
                    <button class="filter-btn active" data-filter="all">All Changes</button>
                    <button class="filter-btn" data-filter="breaking">Breaking</button>
                    <button class="filter-btn" data-filter="added">Added</button>
                    <button class="filter-btn" data-filter="removed">Removed</button>
                    <button class="filter-btn" data-filter="modified">Modified</button>
                </div>
            </div>

            <div class="stats-summary" id="statsSummary">
                <div class="stat-item">
                    <span class="stat-number" id="totalChanges">0</span>
                    <div class="stat-label">Total Changes</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="breakingChanges">0</span>
                    <div class="stat-label">Breaking Changes</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="addedItems">0</span>
                    <div class="stat-label">Added</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="removedItems">0</span>
                    <div class="stat-label">Removed</div>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="modifiedItems">0</span>
                    <div class="stat-label">Modified</div>
                </div>
            </div>

            <div class="timeline" id="timeline"></div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    <script>
        class OpenAPIDiff {
            constructor() {
                this.spec1 = null;
                this.spec2 = null;
                this.changes = [];
                this.initializeEventListeners();
            }

            initializeEventListeners() {
                // File upload handling
                ['upload1', 'upload2'].forEach((id, index) => {
                    const uploadArea = document.getElementById(id);
                    const fileInput = document.getElementById(`file${index + 1}`);
                    
                    uploadArea.addEventListener('click', () => fileInput.click());
                    uploadArea.addEventListener('dragover', this.handleDragOver);
                    uploadArea.addEventListener('dragleave', this.handleDragLeave);
                    uploadArea.addEventListener('drop', (e) => this.handleDrop(e, index + 1));
                    fileInput.addEventListener('change', (e) => this.handleFileSelect(e, index + 1));
                });

                // Compare button
                document.getElementById('compareBtn').addEventListener('click', () => this.compareSpecs());

                // Filter buttons
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.filterChanges(e.target.dataset.filter));
                });
            }

            handleDragOver(e) {
                e.preventDefault();
                e.currentTarget.classList.add('dragover');
            }

            handleDragLeave(e) {
                e.currentTarget.classList.remove('dragover');
            }

            handleDrop(e, fileNumber) {
                e.preventDefault();
                e.currentTarget.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.processFile(files[0], fileNumber);
                }
            }

            handleFileSelect(e, fileNumber) {
                const file = e.target.files[0];
                if (file) {
                    this.processFile(file, fileNumber);
                }
            }

            async processFile(file, fileNumber) {
                try {
                    const content = await this.readFile(file);
                    let parsed;
                    
                    if (file.name.endsWith('.json')) {
                        parsed = JSON.parse(content);
                    } else if (file.name.endsWith('.yaml') || file.name.endsWith('.yml')) {
                        parsed = jsyaml.load(content);
                    } else {
                        throw new Error('Unsupported file format');
                    }

                    if (fileNumber === 1) {
                        this.spec1 = parsed;
                    } else {
                        this.spec2 = parsed;
                    }

                    this.updateFileInfo(file, fileNumber, parsed);
                    this.updateCompareButton();
                } catch (error) {
                    alert(`Error parsing file: ${error.message}`);
                }
            }

            readFile(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsText(file);
                });
            }

            updateFileInfo(file, fileNumber, spec) {
                const info = document.getElementById(`info${fileNumber}`);
                const pathCount = this.countPaths(spec);
                const version = spec.info?.version || 'Unknown';
                
                info.innerHTML = `
                    <strong>${file.name}</strong><br>
                    Version: ${version}<br>
                    Paths: ${pathCount}<br>
                    Size: ${(file.size / 1024).toFixed(1)} KB
                `;
                info.style.display = 'block';
            }

            countPaths(spec) {
                return spec.paths ? Object.keys(spec.paths).length : 0;
            }

            updateCompareButton() {
                const btn = document.getElementById('compareBtn');
                btn.disabled = !(this.spec1 && this.spec2);
            }

            async compareSpecs() {
                if (!this.spec1 || !this.spec2) return;

                const btn = document.getElementById('compareBtn');
                btn.innerHTML = '<div class="loading-spinner"></div> Comparing...';
                btn.disabled = true;

                // Small delay to show loading state
                await new Promise(resolve => setTimeout(resolve, 100));

                try {
                    this.changes = [];
                    this.compareInfo();
                    this.comparePaths();
                    this.compareComponents();
                    
                    this.displayResults();
                } catch (error) {
                    alert(`Error during comparison: ${error.message}`);
                } finally {
                    btn.innerHTML = 'üîç Compare API Specifications';
                    btn.disabled = false;
                }
            }

            compareInfo() {
                const info1 = this.spec1.info || {};
                const info2 = this.spec2.info || {};

                if (info1.version !== info2.version) {
                    this.addChange({
                        type: 'Version Change',
                        path: 'info.version',
                        category: 'modified',
                        isBreaking: false,
                        details: {
                            old: info1.version,
                            new: info2.version
                        }
                    });
                }

                if (info1.title !== info2.title) {
                    this.addChange({
                        type: 'Title Change',
                        path: 'info.title',
                        category: 'modified',
                        isBreaking: false,
                        details: {
                            old: info1.title,
                            new: info2.title
                        }
                    });
                }
            }

            comparePaths() {
                const paths1 = this.spec1.paths || {};
                const paths2 = this.spec2.paths || {};

                const allPaths = new Set([...Object.keys(paths1), ...Object.keys(paths2)]);

                allPaths.forEach(path => {
                    if (paths1[path] && !paths2[path]) {
                        this.addChange({
                            type: 'Path Removed',
                            path: path,
                            category: 'removed',
                            isBreaking: true,
                            details: {
                                methods: Object.keys(paths1[path])
                            }
                        });
                    } else if (!paths1[path] && paths2[path]) {
                        this.addChange({
                            type: 'Path Added',
                            path: path,
                            category: 'added',
                            isBreaking: false,
                            details: {
                                methods: Object.keys(paths2[path])
                            }
                        });
                    } else if (paths1[path] && paths2[path]) {
                        this.comparePathMethods(path, paths1[path], paths2[path]);
                    }
                });
            }

            comparePathMethods(path, methods1, methods2) {
                const allMethods = new Set([...Object.keys(methods1), ...Object.keys(methods2)]);

                allMethods.forEach(method => {
                    if (method === 'parameters') return; // Skip path-level parameters for now

                    if (methods1[method] && !methods2[method]) {
                        this.addChange({
                            type: `${method.toUpperCase()} Method Removed`,
                            path: `${path}`,
                            category: 'removed',
                            isBreaking: true,
                            details: {
                                method: method,
                                summary: methods1[method].summary
                            }
                        });
                    } else if (!methods1[method] && methods2[method]) {
                        this.addChange({
                            type: `${method.toUpperCase()} Method Added`,
                            path: `${path}`,
                            category: 'added',
                            isBreaking: false,
                            details: {
                                method: method,
                                summary: methods2[method].summary
                            }
                        });
                    } else if (methods1[method] && methods2[method]) {
                        this.compareMethodDetails(path, method, methods1[method], methods2[method]);
                    }
                });
            }

            compareMethodDetails(path, method, method1, method2) {
                // Compare responses
                const responses1 = method1.responses || {};
                const responses2 = method2.responses || {};
                
                const allStatusCodes = new Set([...Object.keys(responses1), ...Object.keys(responses2)]);
                
                allStatusCodes.forEach(statusCode => {
                    if (responses1[statusCode] && !responses2[statusCode]) {
                        this.addChange({
                            type: 'Response Removed',
                            path: `${path}.${method}.responses.${statusCode}`,
                            category: 'removed',
                            isBreaking: true,
                            details: {
                                statusCode,
                                description: responses1[statusCode].description
                            }
                        });
                    } else if (!responses1[statusCode] && responses2[statusCode]) {
                        this.addChange({
                            type: 'Response Added',
                            path: `${path}.${method}.responses.${statusCode}`,
                            category: 'added',
                            isBreaking: false,
                            details: {
                                statusCode,
                                description: responses2[statusCode].description
                            }
                        });
                    }
                });

                // Compare parameters
                const params1 = method1.parameters || [];
                const params2 = method2.parameters || [];
                
                this.compareParameters(path, method, params1, params2);

                // Compare request body
                if (method1.requestBody && !method2.requestBody) {
                    this.addChange({
                        type: 'Request Body Removed',
                        path: `${path}.${method}.requestBody`,
                        category: 'removed',
                        isBreaking: true,
                        details: {
                            required: method1.requestBody.required
                        }
                    });
                } else if (!method1.requestBody && method2.requestBody) {
                    this.addChange({
                        type: 'Request Body Added',
                        path: `${path}.${method}.requestBody`,
                        category: 'added',
                        isBreaking: method2.requestBody.required,
                        details: {
                            required: method2.requestBody.required
                        }
                    });
                }
            }

            compareParameters(path, method, params1, params2) {
                const paramMap1 = new Map(params1.map(p => [`${p.name}-${p.in}`, p]));
                const paramMap2 = new Map(params2.map(p => [`${p.name}-${p.in}`, p]));

                // Find removed parameters
                paramMap1.forEach((param, key) => {
                    if (!paramMap2.has(key)) {
                        this.addChange({
                            type: 'Parameter Removed',
                            path: `${path}.${method}.parameters.${param.name}`,
                            category: 'removed',
                            isBreaking: param.required,
                            details: {
                                name: param.name,
                                in: param.in,
                                required: param.required,
                                type: param.schema?.type
                            }
                        });
                    }
                });

                // Find added parameters
                paramMap2.forEach((param, key) => {
                    if (!paramMap1.has(key)) {
                        this.addChange({
                            type: 'Parameter Added',
                            path: `${path}.${method}.parameters.${param.name}`,
                            category: 'added',
                            isBreaking: param.required,
                            details: {
                                name: param.name,
                                in: param.in,
                                required: param.required,
                                type: param.schema?.type
                            }
                        });
                    } else {
                        // Compare existing parameters
                        const oldParam = paramMap1.get(key);
                        if (oldParam.required !== param.required) {
                            this.addChange({
                                type: 'Parameter Modified',
                                path: `${path}.${method}.parameters.${param.name}`,
                                category: 'modified',
                                isBreaking: param.required && !oldParam.required,
                                details: {
                                    name: param.name,
                                    change: 'required',
                                    old: oldParam.required,
                                    new: param.required
                                }
                            });
                        }
                    }
                });
            }

            compareComponents() {
                const components1 = this.spec1.components || {};
                const components2 = this.spec2.components || {};

                // Compare schemas
                this.compareSchemas(components1.schemas || {}, components2.schemas || {});
            }

            compareSchemas(schemas1, schemas2) {
                const allSchemas = new Set([...Object.keys(schemas1), ...Object.keys(schemas2)]);

                allSchemas.forEach(schemaName => {
                    if (schemas1[schemaName] && !schemas2[schemaName]) {
                        this.addChange({
                            type: 'Schema Removed',
                            path: `components.schemas.${schemaName}`,
                            category: 'removed',
                            isBreaking: true,
                            details: {
                                schemaName
                            }
                        });
                    } else if (!schemas1[schemaName] && schemas2[schemaName]) {
                        this.addChange({
                            type: 'Schema Added',
                            path: `components.schemas.${schemaName}`,
                            category: 'added',
                            isBreaking: false,
                            details: {
                                schemaName
                            }
                        });
                    } else if (schemas1[schemaName] && schemas2[schemaName]) {
                        this.compareSchemaProperties(schemaName, schemas1[schemaName], schemas2[schemaName]);
                    }
                });
            }

            compareSchemaProperties(schemaName, schema1, schema2) {
                const props1 = schema1.properties || {};
                const props2 = schema2.properties || {};
                const required1 = schema1.required || [];
                const required2 = schema2.required || [];

                const allProps = new Set([...Object.keys(props1), ...Object.keys(props2)]);

                allProps.forEach(propName => {
                    if (props1[propName] && !props2[propName]) {
                        this.addChange({
                            type: 'Schema Property Removed',
                            path: `components.schemas.${schemaName}.properties.${propName}`,
                            category: 'removed',
                            isBreaking: required1.includes(propName),
                            details: {
                                schemaName,
                                property: propName,
                                type: props1[propName].type,
                                wasRequired: required1.includes(propName)
                            }
                        });
                    } else if (!props1[propName] && props2[propName]) {
                        this.addChange({
                            type: 'Schema Property Added',
                            path: `components.schemas.${schemaName}.properties.${propName}`,
                            category: 'added',
                            isBreaking: false,
                            details: {
                                schemaName,
                                property: propName,
                                type: props2[propName].type,
                                isRequired: required2.includes(propName)
                            }
                        });
                    }
                });

                // Check for changes in required fields
                const removedRequired = required1.filter(r => !required2.includes(r));
                const addedRequired = required2.filter(r => !required1.includes(r));

                removedRequired.forEach(propName => {
                    if (props2[propName]) { // Only if property still exists
                        this.addChange({
                            type: 'Property No Longer Required',
                            path: `components.schemas.${schemaName}.required`,
                            category: 'modified',
                            isBreaking: false,
                            details: {
                                schemaName,
                                property: propName
                            }
                        });
                    }
                });

                addedRequired.forEach(propName => {
                    if (props1[propName]) { // Only if property existed before
                        this.addChange({
                            type: 'Property Now Required',
                            path: `components.schemas.${schemaName}.required`,
                            category: 'modified',
                            isBreaking: true,
                            details: {
                                schemaName,
                                property: propName
                            }
                        });
                    }
                });
            }

            addChange(change) {
                change.id = Date.now() + Math.random();
                change.timestamp = new Date().toISOString();
                this.changes.push(change);
            }

            displayResults() {
                document.getElementById('resultsSection').style.display = 'block';
                
                // Update statistics
                this.updateStatistics();
                
                // Sort changes chronologically (by order they were detected)
                this.changes.sort((a, b) => new Date(a.timestamp) - new Date(b.timestamp));
                
                // Display changes
                this.renderChanges();
                
                // Scroll to results
                document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
            }

            updateStatistics() {
                const stats = this.calculateStatistics();
                
                document.getElementById('totalChanges').textContent = stats.total;
                document.getElementById('breakingChanges').textContent = stats.breaking;
                document.getElementById('addedItems').textContent = stats.added;
                document.getElementById('removedItems').textContent = stats.removed;
                document.getElementById('modifiedItems').textContent = stats.modified;
            }

            calculateStatistics() {
                return {
                    total: this.changes.length,
                    breaking: this.changes.filter(c => c.isBreaking).length,
                    added: this.changes.filter(c => c.category === 'added').length,
                    removed: this.changes.filter(c => c.category === 'removed').length,
                    modified: this.changes.filter(c => c.category === 'modified').length
                };
            }

            renderChanges(filter = 'all') {
                const timeline = document.getElementById('timeline');
                let filteredChanges = this.changes;

                if (filter !== 'all') {
                    if (filter === 'breaking') {
                        filteredChanges = this.changes.filter(c => c.isBreaking);
                    } else {
                        filteredChanges = this.changes.filter(c => c.category === filter);
                    }
                }

                if (filteredChanges.length === 0) {
                    timeline.innerHTML = `
                        <div class="no-changes">
                            <div class="no-changes-icon">üéâ</div>
                            <h3>No changes found</h3>
                            <p>The API specifications are identical or no changes match the current filter.</p>
                        </div>
                    `;
                    return;
                }

                timeline.innerHTML = filteredChanges.map(change => this.renderChangeItem(change)).join('');
            }

            renderChangeItem(change) {
                const badgeClass = this.getBadgeClass(change);
                const details = this.renderChangeDetails(change);
                
                return `
                    <div class="change-item" data-category="${change.category}" data-breaking="${change.isBreaking}">
                        <div class="change-header">
                            <div>
                                <div class="change-type">${change.type}</div>
                                <div class="change-path">${change.path}</div>
                            </div>
                            <div class="change-badge ${badgeClass}">
                                ${change.isBreaking ? 'Breaking' : change.category}
                            </div>
                        </div>
                        ${details}
                    </div>
                `;
            }

            getBadgeClass(change) {
                if (change.isBreaking) return 'badge-breaking';
                switch (change.category) {
                    case 'added': return 'badge-added';
                    case 'removed': return 'badge-removed';
                    case 'modified': return 'badge-modified';
                    default: return 'badge-modified';
                }
            }

            renderChangeDetails(change) {
                if (!change.details) return '';

                let detailsHtml = '<div class="change-details">';

                // Handle different types of details
                if (change.details.old !== undefined && change.details.new !== undefined) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Changes:</div>
                            <div class="detail-content">
                                <div class="diff-line diff-removed">- ${this.formatValue(change.details.old)}</div>
                                <div class="diff-line diff-added">+ ${this.formatValue(change.details.new)}</div>
                            </div>
                        </div>
                    `;
                }

                if (change.details.methods && Array.isArray(change.details.methods)) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">HTTP Methods:</div>
                            <div class="detail-content">
                                ${change.details.methods.map(m => m.toUpperCase()).join(', ')}
                            </div>
                        </div>
                    `;
                }

                if (change.details.method) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Method:</div>
                            <div class="detail-content">${change.details.method.toUpperCase()}</div>
                        </div>
                    `;
                }

                if (change.details.summary) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Summary:</div>
                            <div class="detail-content">${change.details.summary}</div>
                        </div>
                    `;
                }

                if (change.details.statusCode) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Status Code:</div>
                            <div class="detail-content">${change.details.statusCode}</div>
                        </div>
                    `;
                }

                if (change.details.name) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Parameter:</div>
                            <div class="detail-content">
                                <strong>${change.details.name}</strong> (${change.details.in || 'unknown'})
                                ${change.details.required ? ' - Required' : ' - Optional'}
                                ${change.details.type ? ` - Type: ${change.details.type}` : ''}
                            </div>
                        </div>
                    `;
                }

                if (change.details.property) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Property:</div>
                            <div class="detail-content">
                                <strong>${change.details.property}</strong>
                                ${change.details.type ? ` (${change.details.type})` : ''}
                                ${change.details.isRequired ? ' - Required' : ''}
                                ${change.details.wasRequired ? ' - Was Required' : ''}
                            </div>
                        </div>
                    `;
                }

                if (change.details.schemaName) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Schema:</div>
                            <div class="detail-content">${change.details.schemaName}</div>
                        </div>
                    `;
                }

                if (change.details.description) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Description:</div>
                            <div class="detail-content">${change.details.description}</div>
                        </div>
                    `;
                }

                if (change.details.required !== undefined) {
                    detailsHtml += `
                        <div class="detail-section">
                            <div class="detail-title">Required:</div>
                            <div class="detail-content">${change.details.required ? 'Yes' : 'No'}</div>
                        </div>
                    `;
                }

                detailsHtml += '</div>';
                return detailsHtml;
            }

            formatValue(value) {
                if (typeof value === 'string') return `"${value}"`;
                if (typeof value === 'object') return JSON.stringify(value, null, 2);
                return String(value);
            }

            filterChanges(filter) {
                // Update active filter button
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-filter="${filter}"]`).classList.add('active');

                // Re-render changes with filter
                this.renderChanges(filter);
            }
        }

        // Initialize the application
        const diffTool = new OpenAPIDiff();

        // Add some example data for testing (remove in production)
        console.log('OpenAPI Diff Tool initialized. Upload two OpenAPI/Swagger files to compare them.');
    </script>
</body>
</html>